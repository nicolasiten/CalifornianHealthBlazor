@page "/BookAppointment"
@using CalifornianHealthBlazor.Data
@using CalifornianHealthBlazor.Helpers
@inject IJSRuntime JsRuntime
@inject ConsultantCalendarService ConsultantCalendarService


<section id="booking" class="section-padding">
    <h2 align="center">Book Appointment</h2>
    <hr style="width: 80%" />
    <div id="evoCalendar"></div>
</section>

@code {

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await BlazorHelpers.RenderCalendar(JsRuntime, this);

            await UpdateAvailableAppointments(DateTime.Today);
        }
    }

    [JSInvokable("DayClicked")]
    public async Task UpdateAvailableAppointments(DateTime date)
    {
        string[] availableTimes = (await ConsultantCalendarService.GetFreeAppointments(date, 1)).ToArray();
        await BlazorHelpers.UpdateAvailableAppointmentsInCalendar(JsRuntime, availableTimes);
    }
}
